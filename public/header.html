<!-- header.html -->
<div style="background-color: #111; color: #fff; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; position: relative;">
  <div style="font-size: 20px;">Jimmy's Pizza</div>
  <div id="mini-cart" style="margin-right: auto; margin-left: 40px;"></div>
  <div id="user-menu" style="cursor: pointer; padding: 5px 10px; border-radius: 4px; background-color: #333;">
    Loading...
  </div>

  <!-- Login/Signup Dropdown -->
  <div id="auth-dropdown" style="display: none; position: absolute; top: 60px; right: 20px; background: #fff; color: #000; border: 1px solid #ccc; padding: 20px; width: 90vw; max-width: 280px; z-index: 999;">
    <div id="auth-toggle">
      <h4 id="auth-title">Login</h4>
    </div>
    <form id="login-form" onsubmit="handleLogin(event)">
      <input type="email" id="login-email" placeholder="Email" required style="width:100%; margin-bottom:10px;" />
      <input type="password" id="login-password" placeholder="Password" required style="width:100%; margin-bottom:10px;" />
      <button type="submit" style="width:100%; background:#F58426; color:white; border:none; padding:10px;">Login</button>
      <p style="font-size: 14px; margin: 10px 0;"><a href="#" onclick="handlePasswordReset()">Forgot password?</a></p>
      <p style="font-size: 14px;">Don't have an account? <a href="#" onclick="toggleAuthMode('signup')">Sign Up</a></p>
    </form>

    <form id="signup-form" onsubmit="handleSignup(event)" style="display:none;">
      <input type="text" id="signup-name" placeholder="Full Name" required style="width:100%; margin-bottom:10px;" />
      <input type="email" id="signup-email" placeholder="Email" required style="width:100%; margin-bottom:10px;" />
      <input type="password" id="signup-password" placeholder="Password" required style="width:100%; margin-bottom:10px;" />
      <button type="submit" style="width:100%; background:#F58426; color:white; border:none; padding:10px;">Sign Up</button>
      <p style="font-size: 14px; margin-top:10px;">Already have an account? <a href="#" onclick="toggleAuthMode('login')">Log In</a></p>
    </form>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="/js/firebase-config.js"></script>

<script>
  const auth = firebase.auth();

  function toggleDropdown(show = true) {
    const dropdown = document.getElementById('auth-dropdown');
    dropdown.style.display = show ? 'block' : 'none';
  }

  function toggleAuthMode(mode) {
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const title = document.getElementById('auth-title');

    if (mode === 'signup') {
      loginForm.style.display = 'none';
      signupForm.style.display = 'block';
      title.textContent = 'Create Account';
    } else {
      loginForm.style.display = 'block';
      signupForm.style.display = 'none';
      title.textContent = 'Login';
    }
  }

  auth.onAuthStateChanged((user) => {
    const userMenu = document.getElementById('user-menu');
    const dropdown = document.getElementById('auth-dropdown');

    if (user) {
      const displayName = user.displayName || user.email || "Account";
      userMenu.textContent = displayName;
      userMenu.onclick = () => {
        auth.signOut().then(() => window.location.reload());
      };
      dropdown.style.display = 'none';
    } else {
      userMenu.textContent = "Sign In";
      userMenu.onclick = () => {
        toggleAuthMode('login');
        toggleDropdown(true);
      };
    }
  });

  function handleLogin(event) {
    event.preventDefault();
    const email = document.getElementById("login-email").value.trim();
    const password = document.getElementById("login-password").value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        toggleDropdown(false);
        window.location.reload();
      })
      .catch(err => alert("Login failed: " + err.message));
  }

  function handleSignup(event) {
    event.preventDefault();
    const name = document.getElementById("signup-name").value.trim();
    const email = document.getElementById("signup-email").value.trim();
    const password = document.getElementById("signup-password").value;
    auth.createUserWithEmailAndPassword(email, password)
      .then(cred => {
        return cred.user.updateProfile({ displayName: name })
          .then(() => cred.user.sendEmailVerification());
      })
      .then(() => {
        alert("Account created! A verification email has been sent.");
        toggleDropdown(false);
        window.location.reload();
      })
      .catch(err => alert("Signup failed: " + err.message));
  }

  function handlePasswordReset() {
    const email = document.getElementById("login-email").value.trim();
    if (!email) {
      alert("Please enter your email address first.");
      return;
    }
    auth.sendPasswordResetEmail(email)
      .then(() => alert("Password reset email sent."))
      .catch(err => alert("Error: " + err.message));
  }

  document.addEventListener("click", function (e) {
    const dropdown = document.getElementById("auth-dropdown");
    const menu = document.getElementById("user-menu");
    if (!dropdown.contains(e.target) && !menu.contains(e.target)) {
      dropdown.style.display = "none";
    }
  });
</script>